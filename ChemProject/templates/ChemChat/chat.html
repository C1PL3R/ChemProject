{% extends "template.html" %}
{% load static %}

{% block title %}{{ title }} | Чат{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'css/desktop/chat.css' %}">
<link rel="stylesheet" href="{% static 'css/desktop/input.css' %}">

{% if chat_id %}
<link rel="stylesheet" href="{% static 'css/mobile/chat_with_id.css' %}">
{% else %}
<link rel="stylesheet" href="{% static 'css/mobile/chat.css' %}">
{% endif %}

<meta name="description" content="Чат із друзями!">
<meta name="author" content="C1PL3R">
{% endblock %}

{% block body %}
<span id="title" style="display: none;">{{ title }} | Чат</span>
<span id="myId" style="display: none;">{{ sender_id }}</span>

<div id="add-contact-container">
    <form id="addContactForm" action="javascript:void(0);">
        <div class="closeBtn-container">
            <h1 style="color: white; font-size: 20px; text-align: center; width: 100%;">Додати контакт</h1>

            <button id="close">
                <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>
                    <title>Закрити</title>
                    <g id="close_square_fill" fill='none' fill-rule='evenodd'>
                        <path
                            d='M24 0v24H0V0zM12.594 23.258l-.012.002-.071.035-.02.004-.014-.004-.071-.036c-.01-.003-.019 0-.024.006l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427c-.002-.01-.009-.017-.016-.018m.264-.113-.014.002-.184.093-.01.01-.003.011.018.43.005.012.008.008.201.092c.012.004.023 0 .029-.008l.004-.014-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014-.034.614c0 .012.007.02.017.024l.015-.002.201-.093.01-.008.003-.011.018-.43-.003-.012-.01-.01z' />
                        <path fill='#FFFFFFFF'
                            d='M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm5.464 3.465a1 1 0 0 1 1.415 0l2.12 2.12 2.122-2.12a1 1 0 1 1 1.415 1.414L13.414 12l2.122 2.121a1 1 0 1 1-1.415 1.415L12 13.414l-2.121 2.122a1 1 0 0 1-1.415-1.415L10.586 12 8.464 9.879a1 1 0 0 1 0-1.414' />
                    </g>
                </svg>
            </button>
        </div>
        {% csrf_token %}
        <div class="username-container">
            <input type="text" class="username_input" placeholder="Нікнейм" name="username" id='username' required />
            <label for="name" class="username_label">Нікнейм</label>
        </div>

        <div id="contact-message"></div>

        <div class="phone-container">
            <input type="tel" class="phone_input" placeholder="Телефон" name="phone" id='phone_number' required />
            <label for="phone" class="phone_label">Телефон</label>
        </div>

        <div class="button-container">
            <button id="sendDataContactBtn" type="submit">Додати контакт</button>
        </div>
    </form>
</div>

<div class="wrapper">
    <div class="contacts">
        <div class="contacts-header">
            <h1>Контакти</h1>
        </div>
        {% if contacts %}
            <div class="contact-list" id="contact-list">
                {% for contact in contacts %}
                <div class="contact" onclick="location.href='/chat/{{ contact.chat_id }}'">
                    <p class="contact_name">{{ contact.username }}</p>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="chooseContact">Контактів немає, додайте його!</p>
        {% endif %}
        <button id="add_contact">
            <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>
                <title>Додати контакт</title>
                <g id="add_square_fill" fill='none' fill-rule='evenodd'>
                    <path
                        d='M24 0v24H0V0zM12.594 23.258l-.012.002-.071.035-.02.004-.014-.004-.071-.036c-.01-.003-.019 0-.024.006l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427c-.002-.01-.009-.017-.016-.018m.264-.113-.014.002-.184.093-.01.01-.003.011.018.43.005.012.008.008.201.092c.012.004.023 0 .029-.008l.004-.014-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014-.034.614c0 .012.007.02.017.024l.015-.002.201-.093.01-.008.003-.011.018-.43-.003-.012-.01-.01z' />
                    <path fill='#FFFFFFFF'
                        d='M3 5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm4 7a1 1 0 0 1 1-1h3V8a1 1 0 1 1 2 0v3h3a1 1 0 1 1 0 2h-3v3a1 1 0 1 1-2 0v-3H8a1 1 0 0 1-1-1' />
                </g>
            </svg>
        </button>
    </div>

    <div class="chat">
        {% if chat_id %}
        <div class="chat-info">
            <div class="receiver-info">
                <p class="username">{{ username }}</p>
                <a class="phone" href="tel:+{{ phone }}">+{{ phone }}</a>
            </div>
            <button id="settingsChatBtn">   
                <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>
                    <title>Налаштування чату</title>
                    <g id="more_2_fill" fill='none'>
                        <path
                            d='M24 0v24H0V0zM12.593 23.258l-.011.002-.071.035-.02.004-.014-.004-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427c-.002-.01-.009-.017-.017-.018m.265-.113-.013.002-.185.093-.01.01-.003.011.018.43.005.012.008.007.201.093c.012.004.023 0 .029-.008l.004-.014-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014-.034.614c0 .012.007.02.017.024l.015-.002.201-.093.01-.008.004-.011.017-.43-.003-.012-.01-.01z' />
                        <path fill='#FFFFFFFF'
                            d='M12 17a2 2 0 1 1 0 4 2 2 0 0 1 0-4m0-7a2 2 0 1 1 0 4 2 2 0 0 1 0-4m0-7a2 2 0 1 1 0 4 2 2 0 0 1 0-4' />
                    </g>
                </svg>
            </button>
        </div>

        <div id="settings-wrapper">
            <div id="settings-chat-container">
                <div id="btns-container">
                    <button id="clean_history_btn" onclick="CleanHistory('{{ chat_id }}')">
                        <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>
                            <title>Очистити історію</title>
                            <g id="broom_fill" fill='none' fill-rule='evenodd'>
                                <path
                                    d='M24 0v24H0V0zM12.594 23.258l-.012.002-.071.035-.02.004-.014-.004-.071-.036c-.01-.003-.019 0-.024.006l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427c-.002-.01-.009-.017-.016-.018m.264-.113-.014.002-.184.093-.01.01-.003.011.018.43.005.012.008.008.201.092c.012.004.023 0 .029-.008l.004-.014-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014-.034.614c0 .012.007.02.017.024l.015-.002.201-.093.01-.008.003-.011.018-.43-.003-.012-.01-.01z' />
                                <path fill='#FFFFFFFF'
                                    d='M17.278 2.613a1 1 0 0 1 1.89.643l-.038.11-2.61 6.42.657.175c1.05.281 1.924 1.134 2.09 2.298.142 1 .275 2.52.092 4.086-.182 1.552-.69 3.278-1.947 4.546-.462.466-1.125.54-1.573.548-.511.008-1.1-.07-1.705-.19-1.216-.242-2.675-.69-4.054-1.166l-.414-.145-.813-.294-.78-.291-.734-.283-.978-.388a69.486 69.486 0 0 1-1.648-.684 1 1 0 0 1-.22-1.704c1.378-1.08 2.67-2.322 3.762-3.469l.528-.564c.086-.092.17-.184.251-.274l.472-.527.22-.252.594-.695.337-.406a3.096 3.096 0 0 1 2.981-1.087l.199.046.737.197zm-3.959 8.385a1.09 1.09 0 0 0-1.116.378l-.243.293 5.398 1.446-.047-.392a16.467 16.467 0 0 0-.025-.182c-.036-.253-.215-.491-.51-.61l-.116-.038zM5.565 7.716l.064.14A3.26 3.26 0 0 0 6.866 9.22l.1.058a.068.068 0 0 1 0 .118l-.1.058A3.26 3.26 0 0 0 5.63 10.82l-.064.139a.071.071 0 0 1-.13 0l-.064-.14a3.26 3.26 0 0 0-1.237-1.364l-.1-.058a.068.068 0 0 1 0-.118l.1-.058A3.26 3.26 0 0 0 5.37 7.855l.064-.139a.071.071 0 0 1 .13 0Zm2.832-4.859c.04-.09.166-.09.206 0l.102.222a5.189 5.189 0 0 0 1.97 2.171l.157.093a.108.108 0 0 1 0 .189l-.158.092a5.189 5.189 0 0 0-1.97 2.172l-.1.222a.113.113 0 0 1-.207 0l-.102-.222a5.189 5.189 0 0 0-1.97-2.172l-.158-.092a.108.108 0 0 1 0-.189l.159-.093a5.189 5.189 0 0 0 1.97-2.171l.1-.222Z' />
                            </g>
                        </svg>
                    </button>
                    <button id="delete_chat_btn" onclick="DeleteChat('{{ chat_id }}')">
                        <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>
                            <title>Видалити контакт</title>
                            <g id="delete_3_fill" fill='none' fill-rule='evenodd'>
                                <path
                                    d='M24 0v24H0V0zM12.594 23.258l-.012.002-.071.035-.02.004-.014-.004-.071-.036c-.01-.003-.019 0-.024.006l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427c-.002-.01-.009-.017-.016-.018m.264-.113-.014.002-.184.093-.01.01-.003.011.018.43.005.012.008.008.201.092c.012.004.023 0 .029-.008l.004-.014-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014-.034.614c0 .012.007.02.017.024l.015-.002.201-.093.01-.008.003-.011.018-.43-.003-.012-.01-.01z' />
                                <path fill='#FFFFFFFF'
                                    d='M7.823 3.368A2 2 0 0 1 9.721 2h4.558a2 2 0 0 1 1.898 1.368L16.72 5H20a1 1 0 1 1 0 2h-1v12a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3V7H4a1 1 0 0 1 0-2h3.28zM9.387 5l.334-1h4.558l.334 1z' />
                            </g>
                        </svg>
                    </button>
                </div>
                <div id="p-container">
                    <p onclick="CleanHistory('{{ chat_id }}')">Очистити історію</p>
                    <p onclick="DeleteChat('{{ chat_id }}')">Видалити контакт</p>
                </div>
            </div>
        </div>

        <div id="chat-messages-list">
            {% for message in message_list %}
            <div
                class="message-item {% if message.sender.id != sender_id %}message-item-sender{% else %}message-item-receiver{% endif %}">
                <p>{{ message.content }}</p>
            </div>
            {% endfor %}
        </div>
        <div class="typeZone">
            <textarea type="text" placeholder="Повідомлення..." id="messageText" rows="1"></textarea>
            <button title="Надіслати" id="sendMessageBtn"
                onclick="SendMessage(sender='{{ sender_id }}', receiver='{{ receiver_id }}')">
                <svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'>
                    <title>Надіслати</title>
                    <g id="send_fill" fill='none'>
                        <path
                            d='M24 0v24H0V0zM12.594 23.258l-.012.002-.071.035-.02.004-.014-.004-.071-.036c-.01-.003-.019 0-.024.006l-.004.01-.017.428.005.02.01.013.104.074.015.004.012-.004.104-.074.012-.016.004-.017-.017-.427c-.002-.01-.009-.017-.016-.018m.264-.113-.014.002-.184.093-.01.01-.003.011.018.43.005.012.008.008.201.092c.012.004.023 0 .029-.008l.004-.014-.034-.614c-.003-.012-.01-.02-.02-.022m-.715.002a.023.023 0 0 0-.027.006l-.006.014-.034.614c0 .012.007.02.017.024l.015-.002.201-.093.01-.008.003-.011.018-.43-.003-.012-.01-.01z' />
                        <path fill='#09244BFF'
                            d='M20.235 5.686c.432-1.195-.726-2.353-1.921-1.92L3.709 9.048c-1.199.434-1.344 2.07-.241 2.709l4.662 2.699 4.163-4.163a1 1 0 0 1 1.414 1.414L9.544 15.87l2.7 4.662c.638 1.103 2.274.957 2.708-.241z' />
                    </g>
                </svg>
            </button>
        </div>

        <span style="display: none;" id="chat_id">{{ chat_id }}</span>
        {% else %}
        <p class="chooseContact">Виберіть контакт, щоб почати чат!</p>
        {% endif %}
    </div>
</div>

<script src="{% static 'js/chat.js' %}"></script>
{% endblock %}